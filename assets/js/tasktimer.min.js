(function(a){var g=function(){return this}();g.String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};g.String.prototype.ltrim=function(){return this.replace(/^\s+/,"")};g.String.prototype.rtrim=function(){return this.replace(/\s+$/,"")};var i=function(a){var e;if("object"===typeof a&&null!==a){var d="increment reset getTimeSpent getName getId setName remove isFlushable".split(" ");for(e=0;e<d.length;e+=1)if(!a.hasOwnProperty(d[e]))return!1;return!0}return!1},m=function(a){var e="",
d=0,f="",c=!1,b=function(a){return{name:"TaskException",message:a,toString:function(){return this.name+": "+this.message}}};if("object"!==typeof a&&"undefined"!==typeof a)if("function"===typeof a.toString)e=a.toString();else throw new b("Constructor: uniqueId is not stringifyable.");else throw new b("Constructor: uniqueId is not stringifyable, is "+typeof a);return{increment:function(){d+=1;return this},reset:function(){d=0;return this},getTimeSpent:function(){return d},getName:function(){return f},
getId:function(){return e},setName:function(a){a=a.trim();if("string"===typeof a)100<a.length?f=a.substr(0,97)+"...":0<a.length&&(f=a);else throw new b("setName: type mismatch. newName should be of type string, "+typeof a+" given.");return this},remove:function(){c=!0;return null},isFlushable:function(){return c}}},n=function(){var a=[],e="",d=!1,f=function(a){return{name:"TaskGroupException",message:a,toString:function(){return this.name+": "+this.message}}};if("object"!==typeof uniqueId&&"undefined"!==
typeof uniqueId){if("function"!==typeof uniqueId.toString)throw new f("Constructor: uniqueId is not stringifyable.");}else throw new f("Constructor: uniqueId is not stringifyable, is "+typeof uniqueId);return{addTask:function(c){if(i(c)){var b;a:{for(b=0;b<a.length;b+=1)if(a[b]==c){b=!0;break a}b=!1}b||a.push(c)}else throw new f("addTask: taskObject does not have a valid Task interface.");return this},removeTask:function(c){var b;for(b=0;b<a.length;b+=1)if(a[b]==c){a.splice(b,1);break}return this},
getTimeSpent:function(){var c,b=0;for(c=0;c<a.length;c+=1)b+=a[c].getTimeSpent();return b},getName:function(){return e},setName:function(a){if("string"===typeof a)a=a.trim(),50<a.length?e=a.substr(0,47)+"...":0<a.trim.length&&(e=a);else throw new f("setName: type mismatch. newName should be of type string, "+typeof a+" given.");return this},flushDeletedTasks:function(){var c,b=[];for(c=0;c<a.length;c+=1)a[c].isFlushable()&&b.push(a[c]);for(c=0;c<b.length;c+=1)this.removeTask(b[c]);return this},remove:function(){d=
!0},isFlushable:function(){return d}}},p=function(){var a={},e={},d=0,f=0,c=null,b=0,h=!1,j=function(a){return{name:"TaskTimerException",message:a,toString:function(){return this.name+": "+this.message}}},k=function(){for(var b in a)a.hasOwnProperty(b)&&a[b].isFlushable()&&delete a[b];for(b in e)e.hasOwnProperty(b)&&e[b].flushDeletedTasks();i(c)&&c.isFlushable()&&(c=null);for(var d in e)e.hasOwnProperty(d)&&e[d].isFlushable()&&delete e[d];i(c)&&c.increment()},l=function(){clearInterval(b);b=g.setInterval(k,
1E3);h=!0};return{getTaskById:function(b){if("string"===typeof b){if("undefined"!==typeof a[b])return a[b]}else throw new j("getTaskById: type mismatch. taskId should be of type string, "+typeof b+" given.");return null},createTask:function(){var b="task_"+(++d).toString(),c=new m(b);return a[b]=c},activateTask:function(a){if(i(a))c=a;else throw new j("activateTask: taskObject does not have a valid Task interface");return null},getTotalTimeSpent:function(){var b=0,c;for(c in a)a.hasOwnProperty(c)&&
(b+=a[c].getTimeSpent());return b},createGroup:function(){var a="group_"+(++f).toString(),b=new n(a);return e[a]=b},startTimer:function(){l();return null},resumeTimer:function(){l();return null},pauseTimer:function(){g.clearInterval(b);h=!1;return null},isRunning:function(){return h},intervalCatchup:function(){k()}}};a(function(){var g=a("#container"),e=function(a){var b=[{name:"days",seconds:86400,denoter:"d"},{name:"hours",seconds:3600,denoter:"h"},{name:"minutes",seconds:60,denoter:"m"},{name:"seconds",
seconds:1,denoter:"s"}],c=[],d,e=0;for(d=0;d<b.length;d+=1)e=Math.floor(a/b[d].seconds),0<e&&c.push(e.toString()+b[d].denoter),a%=b[d].seconds;0===c.length&&c.push("0"+b[d-1].denoter);return c.join(" ")},d=new p,f=a("<button>").html("New task").click(function(c){c.preventDefault();c=d.createTask();b.find("tbody").append(a("<tr>",{id:c.getId()}).append(a("<td>",{"class":"active-column"}).html(a("<input>",{type:"radio",name:"taskselect"}).click(function(){d.activateTask(d.getTaskById(a(this).closest("tr").attr("id")))})),
a("<td>").html(a("<input>",{type:"text",placeholder:"Add task name",value:c.getId()})),a("<td>",{"class":"timespent-column"}).html("0s"),a("<td>",{"class":"delete-column"}).html(a("<button>").html("Delete").click(function(b){var c=d.getTaskById(a(this).closest("tr").attr("id"));b.preventDefault();var b="Are you sure you want to delete the task named '"+c.getName()+"'? You cannot undo this.",e=Date.now(),b=window.confirm(b),h=Date.now()-e,e=function(){d.intervalCatchup()},f,h=Math.round(h/1E3);for(f=
0;f<h;e(),f+=1);b&&(c.remove(),a(this).closest("tr").remove())})))).find("tr").last().find("input[type=text]").focus()}),c=a("<button>").html("Start timer").click(function(b){b.preventDefault();d.isRunning()?(d.pauseTimer(),a(this).html("Resume timer")):(d.resumeTimer(),a(this).html("Pause timer"))}),b=a("<table>").append(a("<thead>").append(a("<tr>").append(a("<th>",{"class":"active-column"}).html("Active"),a("<th>").html("Task name"),a("<th>",{"class":"timespent-column"}).html("Time spent"),a("<th>",
{"class":"delete-column"}).html("Delete?"))),a("<tbody>"),a("<tfoot>").append(a("<tr>").append(a("<td>",{colspan:2}).html("Total time spent"),a("<td>",{"class":"timespent-column"}).html("0s"),a("<td>").html(""))));a(b).on("click","td label",function(){$td=a(this).closest("td");a(this).replaceWith(a("<input>",{type:"text",placeholder:"Add task name",value:a(this).html()}));$td.find("input").focus()});a(b).on("keydown","td input[type=text]",function(b){13===b.which&&(b=d.getTaskById(a(this).closest("tr").attr("id")),
b.setName(a(this).val()),a(this).replaceWith(a("<label>").html(b.getName())))}).on("blur","td input[type=text]",function(){var b=d.getTaskById(a(this).closest("tr").attr("id"));b.setName(a(this).val());a(this).replaceWith(a("<label>").html(b.getName()))}).on("focus","td input[type=text]",function(){this.select()});g.append(a("<menu>").append(f,c),b);setInterval(function(){b.find("tbody tr").removeClass("active");b.find("tbody tr input[type=radio]:checked").closest("tr").addClass("active");b.find("tbody tr").each(function(b,
c){var f=d.getTaskById(a(c).attr("id"));a(".timespent-column",c).html(e(f.getTimeSpent()))});b.find("tfoot td.timespent-column").html(e(d.getTotalTimeSpent()))},500)})})(jQuery);